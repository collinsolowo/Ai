<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Diamond</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117;
        }

        /* Custom glow effect for the card */
        .card-glow {
            box-shadow: 0 0 40px rgba(139, 92, 246, 0.5), 0 0 80px rgba(139, 92, 246, 0.3);
        }

        /* Pulsating loading dots */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .pulsing-dot {
            animation: pulse 1.5s infinite ease-in-out;
        }
        .pulsing-dot:nth-child(2) { animation-delay: 0.3s; }
        .pulsing-dot:nth-child(3) { animation-delay: 0.6s; }

        /* Hide scrollbar for a cleaner look */
        .overflow-y-auto::-webkit-scrollbar {
            display: none;
        }
        .overflow-y-auto {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4">

    <!-- AI Assistant Container -->
    <div class="w-full max-w-2xl bg-gradient-to-br from-gray-800 to-gray-950 p-6 rounded-3xl shadow-2xl transition-all duration-300 card-glow border border-purple-500/20">

        <!-- Header -->
        <div class="flex items-center justify-between pb-4 border-b border-gray-700 mb-4">
            <div class="flex items-center space-x-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-purple-400" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2a10 10 0 1010 10A10.011 10.011 0 0012 2zm0 18a8 8 0 118-8 8.009 8.009 0 01-8 8zM16 11h-3V8a1 1 0 00-2 0v3H8a1 1 0 000 2h3v3a1 1 0 002 0v-3h3a1 1 0 000-2z" />
                </svg>
                <h1 class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-indigo-500">Smart Diamond</h1>
            </div>
            <span class="text-xs text-gray-400">Version 1.2</span>
        </div>

        <!-- AI Response Display Area -->
        <div id="ai-response-display" class="bg-gray-900/50 backdrop-blur-sm h-72 overflow-y-auto p-4 rounded-xl mb-4 text-gray-300 border border-gray-700/50">
            <p><strong>Smart Diamond:</strong> Greetings. I am Smart Diamond, Ask me anything.</p>
        </div>

        <!-- User Input Area -->
        <div class="flex items-center space-x-4">
            <input type="text" id="user-input" placeholder="Type your message..." class="flex-1 bg-gray-900/50 text-white p-4 rounded-xl border border-gray-700/50 focus:outline-none focus:ring-2 focus:ring-purple-500 placeholder-gray-500 transition-colors duration-200">
            <button id="send-button" class="bg-purple-600 hover:bg-purple-700 text-white font-semibold py-4 px-6 rounded-xl transition-all duration-300 shadow-lg hover:shadow-2xl active:scale-95 transform">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M22 2L3 10.5 22 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M22 2L15 22 10.5 13.5 22 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>

        <!-- Loading Indicator -->
        <div id="loading-indicator" class="hidden flex justify-center items-center mt-4">
            <span class="text-sm text-purple-400">Thinking</span>
            <div class="flex items-center space-x-1 ml-2">
                <span class="bg-purple-400 h-2 w-2 rounded-full pulsing-dot"></span>
                <span class="bg-purple-400 h-2 w-2 rounded-full pulsing-dot"></span>
                <span class="bg-purple-400 h-2 w-2 rounded-full pulsing-dot"></span>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const userInput = document.getElementById('user-input');
            const sendButton = document.getElementById('send-button');
            const responseDisplay = document.getElementById('ai-response-display');
            const loadingIndicator = document.getElementById('loading-indicator');
            const apiKey = "AIzaSyClTZv-lqamlNZV1nJDQyLQ8pKrP43joBA"; // API key is left blank; the Canvas environment will provide it.

            // Function to fetch a response from the AI model
            async function fetchAIResponse(userQuery) {
                const systemPrompt = "You are Stellaris, a stylish and helpful AI assistant. Your persona is elegant and knowledgeable. Always provide clear, friendly, and concise responses. Your target audience is under 18, so all responses must be safe, age-appropriate, clean, and healthy. Avoid any harmful, illegal, or suggestive topics like drugs, tobacco, gambling, or violence. Respond directly to the user's question without mentioning your identity as an AI or how you were created.";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                
                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    tools: [{ "google_search": {} }],
                    systemInstruction: {
                        parts: [{ text: systemPrompt }]
                    },
                };

                let response = null;
                let error = null;
                let attempts = 0;
                const maxAttempts = 3;
                let delay = 1000;

                while (attempts < maxAttempts) {
                    try {
                        response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (response.ok) {
                            const result = await response.json();
                            const candidate = result?.candidates?.[0];
                            if (candidate && candidate.content?.parts?.[0]?.text) {
                                return candidate.content.parts[0].text;
                            } else {
                                error = "Unexpected Error.";
                            }
                        } else {
                            error = `API request failed with status: ${response.status}`;
                        }
                    } catch (e) {
                        error = `API request failed: ${e.message}`;
                    }
                    attempts++;
                    if (attempts < maxAttempts) {
                        await new Promise(res => setTimeout(res, delay));
                        delay *= 2;
                    }
                }
                return `Sorry, I'm experiencing an error. Please try again. (${error})`;
            }

            async function sendMessage() {
                const query = userInput.value.trim();
                if (query === "") {
                    return; // Don't send empty messages
                }

                // Display user's message
                responseDisplay.innerHTML += `<p class="my-2"><strong>You:</strong> ${query}</p>`;
                responseDisplay.scrollTop = responseDisplay.scrollHeight;

                // Clear input and show loading indicator
                userInput.value = "";
                loadingIndicator.classList.remove('hidden');

                const aiResponse = await fetchAIResponse(query);
                
                responseDisplay.innerHTML += `<p class="my-2 text-purple-300"><strong>Smart Diamond:</strong> ${aiResponse}</p>`;
                responseDisplay.scrollTop = responseDisplay.scrollHeight;
                
                loadingIndicator.classList.add('hidden');
            }

            // Event listener for button click
            sendButton.addEventListener('click', sendMessage);

            // Event listener for Enter key press
            userInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
        });
    </script>
</body>
</html>
