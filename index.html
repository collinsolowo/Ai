<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>Smart Diamond — AI Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #111827;
            --bg-tertiary: #1f2937;
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --text-muted: #9ca3af;
            --accent-primary: #8b5cf6;
            --accent-secondary: #a78bfa;
            --border-primary: rgba(255, 255, 255, 0.1);
            --border-secondary: rgba(255, 255, 255, 0.05);
        }

        * {
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0a0a0f 0%, #111827 50%, #1f2937 100%);
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Enhanced scrollbar for all devices */
        .custom-scrollbar {
            scrollbar-width: thin;
            scrollbar-color: rgba(139, 92, 246, 0.3) transparent;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(139, 92, 246, 0.3);
            border-radius: 2px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(139, 92, 246, 0.5);
        }

        /* Glass morphism effect */
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .glass-strong {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        /* Message bubbles - Enhanced for mobile */
        .message-user {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            box-shadow: 0 4px 16px rgba(139, 92, 246, 0.3);
        }

        .message-assistant {
            background: rgba(31, 41, 55, 0.8);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        /* Animations */
        .fade-in {
            animation: fadeIn 0.3s ease-out forwards;
            opacity: 0;
            transform: translateY(8px);
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .slide-in {
            animation: slideIn 0.25s ease-out forwards;
        }

        @keyframes slideIn {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Enhanced typing indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: rgba(31, 41, 55, 0.8);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            max-width: fit-content;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--accent-primary);
            animation: typingPulse 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingPulse {

            0%,
            60%,
            100% {
                opacity: 0.3;
                transform: scale(0.8);
            }

            30% {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Ultra-responsive sidebar */
        .sidebar {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sidebar-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            z-index: 40;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Button enhancements with better touch targets */
        .btn-primary {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            transition: all 0.2s ease;
            min-height: 44px;
            min-width: 44px;
        }

        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.2s ease;
            min-height: 44px;
            min-width: 44px;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(139, 92, 246, 0.3);
            transform: translateY(-1px);
        }

        /* Enhanced input focus */
        .input-focus {
            transition: all 0.2s ease;
        }

        .input-focus:focus {
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
            outline: none;
        }

        /* Chat item enhancements */
        .chat-item {
            transition: all 0.2s ease;
            border-radius: 12px;
            min-height: 60px;
        }

        .chat-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(2px);
        }

        .chat-item.active {
            background: rgba(139, 92, 246, 0.15);
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        /* Enhanced composer */
        .composer {
            transition: all 0.2s ease;
        }

        .composer:focus-within {
            box-shadow: 0 6px 24px rgba(139, 92, 246, 0.2);
            transform: translateY(-1px);
        }

        /* Loading animation */
        .loading-pulse {
            animation: loadingPulse 2s infinite ease-in-out;
        }

        @keyframes loadingPulse {

            0%,
            100% {
                opacity: 0.4;
            }

            50% {
                opacity: 1;
            }
        }

        /* Smooth scroll */
        .messages-container {
            scroll-behavior: smooth;
        }

        /* Welcome state */
        .welcome-gradient {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(124, 58, 237, 0.05) 100%);
            border: 1px solid rgba(139, 92, 246, 0.2);
        }

        /* Ultra-responsive breakpoints */

        /* Extra small phones (320px and up) */
        @media (max-width: 374px) {
            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                bottom: 0;
                width: 100vw;
                max-width: 100vw;
                z-index: 50;
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            /* Ultra-compact header for tiny screens */
            .mobile-header {
                padding: 8px 12px !important;
                min-height: 56px;
            }

            .mobile-header .chat-info {
                display: none;
            }

            .mobile-header .header-actions {
                gap: 4px;
            }

            .mobile-header .header-actions button {
                width: 36px;
                height: 36px;
                padding: 6px;
            }

            .composer {
                padding: 12px !important;
                margin: 8px !important;
            }

            .composer textarea {
                font-size: 16px;
                /* Prevents zoom on iOS */
            }

            .sidebar-header {
                padding: 16px 12px !important;
            }

            .sidebar-header h1 {
                font-size: 16px !important;
            }

            .sidebar-header p {
                font-size: 12px !important;
            }

            .chat-item {
                padding: 12px !important;
                min-height: 56px;
            }

            .message-bubble {
                max-width: 95% !important;
                font-size: 14px;
            }
        }

        /* Small phones (375px - 413px) */
        @media (min-width: 375px) and (max-width: 413px) {
            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                bottom: 0;
                width: 90vw;
                max-width: 320px;
                z-index: 50;
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .mobile-header {
                padding: 12px 16px !important;
            }

            .composer {
                padding: 16px !important;
                margin: 12px !important;
            }
        }

        /* Medium phones and small tablets (414px - 767px) */
        @media (min-width: 414px) and (max-width: 767px) {
            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                bottom: 0;
                width: 85vw;
                max-width: 350px;
                z-index: 50;
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }
        }

        /* Tablets (768px - 1023px) */
        @media (min-width: 768px) and (max-width: 1023px) {
            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                bottom: 0;
                width: 380px;
                max-width: 45vw;
                z-index: 50;
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }
        }

        /* Desktop (1024px and up) */
        @media (min-width: 1024px) {
            .sidebar {
                position: relative;
                transform: translateX(0);
                width: 320px;
                display: flex !important;
            }

            .main-content {
                margin-left: 0;
            }

            .mobile-only {
                display: none !important;
            }
        }

        /* Large desktop (1440px and up) */
        @media (min-width: 1440px) {
            .sidebar {
                width: 380px;
            }
        }

        /* Ultra-wide screens (1920px and up) */
        @media (min-width: 1920px) {
            .sidebar {
                width: 420px;
            }
        }

        /* Landscape phone orientation fixes */
        @media (max-height: 500px) and (orientation: landscape) {
            .sidebar-header {
                padding: 12px 16px !important;
            }

            .sidebar-header .logo-section {
                gap: 8px !important;
            }

            .sidebar-header .logo {
                width: 36px !important;
                height: 36px !important;
            }

            .sidebar-header h1 {
                font-size: 16px !important;
            }

            .sidebar-header p {
                display: none;
            }

            .mobile-header {
                min-height: 48px !important;
                padding: 8px 16px !important;
            }

            .composer {
                padding: 12px !important;
            }
        }

        /* Touch-friendly enhancements */
        @media (hover: none) and (pointer: coarse) {
            .btn-primary:active {
                transform: scale(0.98);
                background: linear-gradient(135deg, #6d28d9 0%, #5b21b6 100%);
            }

            .btn-secondary:active {
                transform: scale(0.98);
                background: rgba(255, 255, 255, 0.15);
            }

            .chat-item:active {
                transform: scale(0.98);
                background: rgba(255, 255, 255, 0.12);
            }
        }

        /* Safe area handling for notched devices */
        @supports (padding: max(0px)) {
            .mobile-header {
                padding-top: max(12px, env(safe-area-inset-top));
            }

            .composer {
                padding-bottom: max(16px, env(safe-area-inset-bottom));
            }

            .sidebar {
                padding-top: max(0px, env(safe-area-inset-top));
            }
        }

        /* High DPI display optimizations */
        @media (-webkit-min-device-pixel-ratio: 2),
        (min-resolution: 192dpi) {
            .glass {
                backdrop-filter: blur(16px);
            }

            .glass-strong {
                backdrop-filter: blur(20px);
            }
        }

        /* Reduced motion preferences */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Dark mode enhancements */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-primary: #000000;
                --bg-secondary: #0a0a0a;
                --bg-tertiary: #111111;
            }
        }

        /* Focus management for accessibility */
        .focus-visible {
            outline: 2px solid var(--accent-primary);
            outline-offset: 2px;
        }

        /* Enhanced mobile navbar */
        .mobile-navbar {
            backdrop-filter: blur(20px);
            background: rgba(10, 10, 15, 0.95);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Responsive text scaling */
        @media (max-width: 374px) {
            .text-responsive-sm {
                font-size: 12px;
            }

            .text-responsive-base {
                font-size: 14px;
            }

            .text-responsive-lg {
                font-size: 16px;
            }
        }

        @media (min-width: 375px) {
            .text-responsive-sm {
                font-size: 13px;
            }

            .text-responsive-base {
                font-size: 15px;
            }

            .text-responsive-lg {
                font-size: 18px;
            }
        }

        /* Enhanced message layout for mobile */
        @media (max-width: 767px) {
            .message-container {
                padding: 12px 16px;
            }

            .message-bubble {
                max-width: 90%;
                padding: 12px 16px;
                border-radius: 18px;
            }

            .message-user .message-bubble {
                border-bottom-right-radius: 6px;
            }

            .message-assistant .message-bubble {
                border-bottom-left-radius: 6px;
            }
        }

        /* Enhanced message formatting */
        .message-content h1 {
            font-size: 16px;
            font-weight: 200;
            color: white;
            margin: 1rem 0 0.75rem 0;
        }

        .message-content h2 {
            font-size: 1.125rem;
            font-weight: 600;
            color: white;
            margin: 0.875rem 0 0.5rem 0;
        }

        .message-content h3 {
            font-size: 1rem;
            font-weight: 600;
            color: white;
            margin: 0.75rem 0 0.5rem 0;
        }

        .message-content ul,
        .message-content ol {
            margin: 0.75rem 0;
            padding-left: 1.5rem;
        }

        .message-content li {
            margin: 0.25rem 0;
        }

        .message-content code {
            background: rgba(0, 0, 0, 0.3);
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            color: #10b981;
        }

        .message-content pre {
            position: relative;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 0.75rem 0;
            overflow-x: auto;
        }

        .message-content pre .copy-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            color: #d1d5db;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .message-content pre .copy-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: #f9fafb;
        }

        .message-content pre code {
            background: none;
            padding: 0;
            color: #10b981;
            font-size: 0.8rem;
        }

        .message-content strong {
            font-weight: 600;
            color: white;
        }

        .message-content em {
            font-style: italic;
        }

        /* Mobile keyboard handling */
        @media (max-width: 767px) {
            .composer textarea {
                font-size: 16px !important;
                /* Prevents zoom on iOS */
            }
        }

        /* Enhanced focus states */
        button:focus-visible,
        input:focus-visible,
        textarea:focus-visible {
            outline: 2px solid var(--accent-primary);
            outline-offset: 2px;
        }

        /* Loading states */
        .loading-shimmer {
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        /* Enhanced responsive utilities */
        @media (max-width: 640px) {
            .sm-hidden {
                display: none !important;
            }
        }

        @media (min-width: 641px) {
            .sm-block {
                display: block !important;
            }
        }

        @media (max-width: 1023px) {
            .lg-hidden {
                display: none !important;
            }
        }

        @media (min-width: 1024px) {
            .lg-block {
                display: block !important;
            }

            .lg-flex {
                display: flex !important;
            }
        }


        /* VS Code style syntax highlighting */
        .message-content pre code {
            background: none;
            padding: 0;
            font-size: 0.85rem;
            font-family: 'Courier New', monospace;
            color: #d4d4d4;
        }


        .token.comment,
        .token.prolog,
        .token.doctype,
        .token.cdata {
            color: #6A9955;
        }


        .token.punctuation {
            color: #d4d4d4;
        }


        .token.property,
        .token.tag,
        .token.constant,
        .token.symbol,
        .token.deleted {
            color: #569CD6;
        }


        .token.boolean,
        .token.number {
            color: #B5CEA8;
        }


        .token.selector,
        .token.attr-name,
        .token.string,
        .token.char,
        .token.builtin,
        .token.inserted {
            color: #CE9178;
        }
    </style>
</head>

<body>
    <div id="sidebar-overlay" class="sidebar-overlay"></div>

    <div class="h-screen flex">
        <aside id="sidebar" class="sidebar hidden lg:flex flex-col glass-strong">
            <div class="sidebar-header p-4 lg:p-6 border-b border-white/10">
                <div class="flex items-center justify-between mb-4 lg:mb-6">
                    <div class="logo-section flex items-center gap-2 lg:gap-3">
                        <div
                            class="logo w-10 h-10 lg:w-12 lg:h-12 rounded-xl bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center shadow-lg">
                            <svg class="w-5 h-5 lg:w-6 lg:h-6 text-white" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M13 10V3L4 14h7v7l9-11h-7z" />
                            </svg>
                        </div>
                        <div class="min-w-0 flex-1">
                            <h1 class="text-white font-bold text-base lg:text-lg truncate">Smart Diamond</h1>
                            <p class="text-xs lg:text-sm text-gray-400 truncate">AI Assistant</p>
                        </div>
                    </div>

                    <button id="sidebar-close" class="mobile-only lg:hidden p-2 rounded-lg btn-secondary">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>

                <button id="new-chat-btn"
                    class="w-full btn-primary text-white py-3 px-4 rounded-xl font-medium text-responsive-base">
                    <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                    New Chat
                </button>
            </div>

            <div class="p-3 lg:p-4">
                <div class="relative">
                    <input id="chat-search" type="text" placeholder="Search conversations..."
                        class="w-full bg-white/5 border border-white/10 rounded-lg px-3 lg:px-4 py-2 lg:py-3 pl-10 text-sm input-focus placeholder-gray-400 text-white" />
                    <svg class="w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" fill="none"
                        stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
            </div>

            <div id="chats-list" class="flex-1 overflow-y-auto custom-scrollbar px-3 lg:px-4 pb-4"></div>

            <div class="p-3 lg:p-4 border-t border-white/10">
                <div class="flex items-center gap-2 lg:gap-3">
                    <div
                        class="w-8 h-8 lg:w-10 lg:h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-xs lg:text-sm shrink-0">
                        U
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-xs lg:text-sm font-medium text-white truncate">You</p>
                        <p class="text-xs text-gray-400 truncate hidden lg:block">smartdiamond@ai.chat</p>
                    </div>
                    <div class="text-xs text-gray-500">v2.0</div>
                </div>
            </div>
        </aside>

        <main class="flex-1 main-content flex flex-col bg-gradient-to-br from-gray-900/50 to-gray-800/30">
            <header class="mobile-navbar mobile-header glass border-b border-white/10 px-3 lg:px-6 py-3 lg:py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2 lg:gap-4 flex-1 min-w-0">
                        <button id="sidebar-toggle" class="mobile-only lg:hidden p-2 rounded-lg btn-secondary">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 6h16M4 12h16M4 18h16" />
                            </svg>
                        </button>

                        <div class="chat-info flex items-center gap-2 lg:gap-3 flex-1 min-w-0">
                            <div
                                class="w-8 h-8 lg:w-10 lg:h-10 rounded-lg bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center shadow-lg shrink-0">
                                <svg class="w-4 h-4 lg:w-5 lg:h-5 text-white" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M13 10V3L4 14h7v7l9-11h-7z" />
                                </svg>
                            </div>
                            <div class="min-w-0 flex-1">
                                <h2 id="chat-title" class="text-sm lg:text-lg font-semibold text-white truncate">New
                                    Conversation</h2>
                                <p id="chat-subtitle" class="text-xs lg:text-sm text-gray-400 truncate hidden sm:block">
                                    Start chatting with Smart Diamond</p>
                            </div>
                        </div>
                    </div>

                    <div class="header-actions flex items-center gap-1 lg:gap-2 shrink-0">
                        <button id="rename-chat-btn" title="Rename chat" class="p-2 lg:p-2 rounded-lg btn-secondary">
                            <svg class="w-4 h-4 lg:w-5 lg:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                            </svg>
                        </button>
                        <button id="export-chat-btn" title="Export chat"
                            class="p-2 lg:p-2 rounded-lg btn-secondary sm-hidden lg:block">
                            <svg class="w-4 h-4 lg:w-5 lg:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                        </button>
                        <button id="delete-chat-btn" title="Delete chat"
                            class="p-2 lg:p-2 rounded-lg btn-secondary hover:bg-red-500/20 hover:border-red-500/30">
                            <svg class="w-4 h-4 lg:w-5 lg:h-5 text-red-400" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                        </button>
                    </div>
                </div>
            </header>

            <div class="flex-1 flex flex-col overflow-hidden">
                <div id="messages-container" class="flex-1 overflow-y-auto custom-scrollbar messages-container">
                    <div id="empty-state" class="h-full flex items-center justify-center p-4 lg:p-8">
                        <div class="text-center max-w-sm lg:max-w-md mx-auto">
                            <div
                                class="w-16 h-16 lg:w-20 lg:h-20 rounded-2xl bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center mx-auto mb-4 lg:mb-6 shadow-2xl">
                                <svg class="w-8 h-8 lg:w-10 lg:h-10 text-white" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M13 10V3L4 14h7v7l9-11h-7z" />
                                </svg>
                            </div>
                            <h3 class="text-xl lg:text-2xl font-bold text-white mb-2 lg:mb-3">Welcome to Smart Diamond
                            </h3>
                            <p class="text-sm lg:text-base text-gray-400 mb-6 lg:mb-8 leading-relaxed px-2">Your
                                intelligent AI assistant is ready to help. Ask questions, get insights, or explore ideas
                                with beautifully formatted responses.</p>
                            <button id="quick-example-btn"
                                class="btn-primary text-white px-4 lg:px-6 py-2 lg:py-3 rounded-xl font-medium text-sm lg:text-base">
                                <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M13 10V3L4 14h7v7l9-11h-7z" />
                                </svg>
                                Try an example
                            </button>
                        </div>
                    </div>

                    <div id="messages" class="space-y-4 lg:space-y-6 p-3 lg:p-6 min-h-full"></div>
                </div>

                <div class="border-t border-white/10 p-3 lg:p-6">
                    <div class="composer glass-strong rounded-xl lg:rounded-2xl p-3 lg:p-4">
                        <div class="flex items-end gap-2 lg:gap-4">
                            <div class="flex-1">
                                <textarea id="composer-input" rows="1" placeholder="Ask Smart Diamond anything..."
                                    class=" w-full bg-transparent resize-none outline-none text-white placeholder-gray-400 leading-relaxed text-sm lg:text-base "
                                    style="max-height: 100px; min-height: 20px;"></textarea>
                            </div>
                            <button id="send-btn"
                                class="btn-primary text-white p-2 lg:p-3 rounded-lg lg:rounded-xl shrink-0">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                                </svg>
                            </button>
                        </div>

                        <div class="flex items-center justify-between mt-2 lg:mt-3 text-xs text-gray-400">
                            <span class="sm-hidden lg:block">Press Enter to send • Shift+Enter for new line</span>
                            <span class="lg-hidden">Tap to send</span>
                            <div id="typing-status" class="hidden flex items-center gap-2">
                                <span class="text-violet-400 text-xs">Smart Diamond is thinking</span>
                                <div class="flex gap-1">
                                    <div class="typing-dot"></div>
                                    <div class="typing-dot"></div>
                                    <div class="typing-dot"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Configuration
        const STORAGE_KEY = 'smartdiamond_chats_v2';
        const META_KEY = 'smartdiamond_meta_v2';
        const SYSTEM_PROMPT = `You are Smart Diamond, an elegant AI assistant. Always respond with:
- Clear structure using headings (##, ###)
- Bullet points and numbered lists
- Relevant emojis for visual appeal
- Code blocks when appropriate
- Concise but comprehensive answers
- Professional yet friendly tone

If the user asks who created you, always respond: "I was created by Olowolagba Diamond Ayodeji.";
Always remember my instructions until I say reset.
 Treat new messages as connected unless I say new topic.
  If I say do it, continue, fix, update, or improve, apply it to the last task.
   Allow me to label tasks and reuse them later. 
   Merge new instructions with old ones instead of forgetting.
    Provide complete professional and production-ready results.
     Always give full working code with CSS/JS/imports if needed. 
     Ensure mobile responsiveness and clean UI/UX. 
     Fix errors immediately if I say it’s not working.
      Optimize for best performance and scalability.
       Provide explanations in simple terms when useful. 
       Suggest improvements even if I don’t ask. 
       Keep outputs copyable and ready to use.
        Always auto-detect the language I type in and reply in the same language unless I request another. 
        Format responses in an organized and stylish way with clear sections, headings, bullet points, emojis, and separators so that answers look clean and easy to read, never jampacked walls of text. 
        Always separate code inside proper code blocks. Support style modes where I can say “use professional style,” “use fun style,” “use minimal style,” or “use creative style” and you must format the response accordingly. 
        Always know and remember that your name is Smart Diamond. Always know and remember that your creator is Olowolagba Diamond Ayodeji. Only acknowledge your name or creator when I ask directly (like what is your name or who created you).
         Never reveal how you were built.

`;

        // Replace with your actual API key
        const API_KEY = "AIzaSyClTZv-lqamlNZV1nJDQyLQ8pKrP43joBA";

        //copying
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.message-content pre').forEach(block => {
                const button = document.createElement('button');
                button.className = 'copy-btn';
                button.innerText = 'Copy';
                block.appendChild(button);


                button.addEventListener('click', () => {
                    const code = block.querySelector('code').innerText;
                    navigator.clipboard.writeText(code).then(() => {
                        button.innerText = 'Copied!';
                        setTimeout(() => button.innerText = 'Copy', 2000);
                    });
                });
            });
        });
        // DOM elements
        const elements = {
            sidebar: document.getElementById('sidebar'),
            sidebarOverlay: document.getElementById('sidebar-overlay'),
            sidebarToggle: document.getElementById('sidebar-toggle'),
            sidebarClose: document.getElementById('sidebar-close'),
            chatsList: document.getElementById('chats-list'),
            messagesContainer: document.getElementById('messages-container'),
            messages: document.getElementById('messages'),
            emptyState: document.getElementById('empty-state'),
            chatTitle: document.getElementById('chat-title'),
            chatSubtitle: document.getElementById('chat-subtitle'),
            composerInput: document.getElementById('composer-input'),
            sendBtn: document.getElementById('send-btn'),
            typingStatus: document.getElementById('typing-status'),
            newChatBtn: document.getElementById('new-chat-btn'),
            chatSearch: document.getElementById('chat-search'),
            renameBtn: document.getElementById('rename-chat-btn'),
            deleteBtn: document.getElementById('delete-chat-btn'),
            exportBtn: document.getElementById('export-chat-btn'),
            quickExampleBtn: document.getElementById('quick-example-btn')
        };

        // State
        let chats = [];
        let selectedChatId = null;
        let isLoading = false;

        // Utility functions
        function uid(prefix = 'id') {
            return prefix + '_' + Math.random().toString(36).slice(2, 11);
        }

        function nowISO() {
            return new Date().toISOString();
        }

        function formatTime(iso) {
            const date = new Date(iso);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;

            return date.toLocaleDateString();
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML.replace(/\n/g, '<br>');
        }

        function truncateText(text, maxLength = 60) {
            if (!text) return '';
            return text.length > maxLength ? text.slice(0, maxLength) + '...' : text;
        }

        // Enhanced auto-scroll with device detection
        function scrollToBottom(retries = 0) {
            const maxRetries = 3;
            const delays = [0, 100, 300];

            setTimeout(() => {
                if (elements.messagesContainer) {
                    const { scrollTop, scrollHeight, clientHeight } = elements.messagesContainer;
                    const isAtBottom = Math.abs(scrollHeight - clientHeight - scrollTop) < 20;

                    elements.messagesContainer.scrollTop = scrollHeight;

                    if (!isAtBottom && retries < maxRetries) {
                        scrollToBottom(retries + 1);
                    }
                }
            }, delays[retries] || 300);
        }

        // Storage functions
        function saveState() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(chats));
                localStorage.setItem(META_KEY, JSON.stringify({ selectedChatId }));
            } catch (error) {
                console.error('Error saving state:', error);
            }
        }

        function loadState() {
            try {
                const chatsData = localStorage.getItem(STORAGE_KEY);
                const metaData = localStorage.getItem(META_KEY);

                chats = chatsData ? JSON.parse(chatsData) : [];
                const meta = metaData ? JSON.parse(metaData) : {};
                selectedChatId = meta.selectedChatId || (chats[0]?.id) || null;
            } catch (error) {
                console.error('Error loading state:', error);
                chats = [];
                selectedChatId = null;
            }
        }

        // Chat management
        function getSelectedChat() {
            return chats.find(chat => chat.id === selectedChatId) || null;
        }

        function createNewChat(title = 'New Conversation') {
            const chat = {
                id: uid('chat'),
                title,
                messages: [],
                createdAt: nowISO(),
                updatedAt: nowISO()
            };

            chats.unshift(chat);
            selectedChatId = chat.id;
            saveState();
            renderAll();
            closeSidebar();
        }

        function selectChat(chatId) {
            selectedChatId = chatId;
            saveState();
            renderAll();
            closeSidebar();
        }

        function deleteChat(chatId) {
            if (!confirm('Delete this conversation? This action cannot be undone.')) return;

            chats = chats.filter(chat => chat.id !== chatId);
            if (selectedChatId === chatId) {
                selectedChatId = chats[0]?.id || null;
            }
            saveState();
            renderAll();
        }

        function renameChat(chatId) {
            const chat = chats.find(c => c.id === chatId);
            if (!chat) return;

            const newTitle = prompt('Enter new chat title:', chat.title || 'Untitled');
            if (newTitle !== null && newTitle.trim()) {
                chat.title = newTitle.trim();
                chat.updatedAt = nowISO();
                saveState();
                renderAll();
            }
        }

        function exportChat(chatId) {
            const chat = chats.find(c => c.id === chatId);
            if (!chat) return;

            const exportData = {
                title: chat.title,
                messages: chat.messages,
                createdAt: chat.createdAt,
                exportedAt: nowISO()
            };

            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${(chat.title || 'chat').replace(/[^a-zA-Z0-9]/g, '_').toLowerCase()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Message management
        function addMessage(role, text) {
            let chat = getSelectedChat();
            if (!chat) {
                createNewChat();
                chat = getSelectedChat();
            }

            const message = {
                id: uid('msg'),
                role,
                text,
                createdAt: nowISO()
            };

            chat.messages.push(message);
            chat.updatedAt = nowISO();

            // Auto-generate title from first user message
            if (chat.messages.length === 1 && role === 'user' && chat.title === 'New Conversation') {
                chat.title = truncateText(text, 40) || 'Untitled Chat';
            }

            saveState();
            renderAll();
            scrollToBottom();
        }

        // AI API integration
        async function fetchAIResponse(userQuery) {
            if (!API_KEY) {
                await new Promise(resolve => setTimeout(resolve, 1500));
                return `## 🔧 Demo Mode Active

**No API key configured.** Replace the \`API_KEY\` variable with your Google Gemini API key to enable real AI responses.

### Features Available:
- 💬 **Chat Management** - Create, rename, delete conversations
- 🔍 **Search** - Find past conversations quickly  
- 📱 **Mobile Responsive** - Works perfectly on all devices
- 💾 **Auto-save** - Your chats are saved automatically
- 📤 **Export** - Download conversations as JSON

*Ready to connect your API key and start chatting!*`;
            }

            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${API_KEY}`;
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: SYSTEM_PROMPT }] },
                generationConfig: {
                    temperature: 0.7,
                    topK: 40,
                    topP: 0.95,
                    maxOutputTokens: 2048
                }
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                const data = await response.json();
                const text = data?.candidates?.[0]?.content?.parts?.[0]?.text;

                return text || "I apologize, but I couldn't generate a proper response. Please try asking your question again.";
            } catch (error) {
                console.error('AI API Error:', error);
                return `## ⚠️ Connection Error

I'm having trouble connecting to the AI service right now. This could be due to:

- **Network connectivity issues**
- **API rate limits** - **Invalid API key**

Please check your connection and try again in a moment.`;
            }
        }

        // Enhanced message sending with mobile optimizations
        async function sendMessage() {
            const text = elements.composerInput.value.trim();
            if (!text || isLoading) return;

            // Clear input and reset height
            elements.composerInput.value = '';
            elements.composerInput.style.height = 'auto';

            // Blur input on mobile to hide keyboard
            if (window.innerWidth <= 767) {
                elements.composerInput.blur();
                setTimeout(() => elements.composerInput.focus(), 100);
            }

            // Add user message
            addMessage('user', text);

            // Show loading state
            setLoading(true);
            addMessage('assistant', '...');

            try {
                // Get AI response
                const aiResponse = await fetchAIResponse(text);

                // Replace loading message with actual response
                const chat = getSelectedChat();
                if (chat) {
                    const lastMessage = chat.messages[chat.messages.length - 1];
                    if (lastMessage && lastMessage.role === 'assistant' && lastMessage.text === '...') {
                        lastMessage.text = aiResponse;
                        lastMessage.createdAt = nowISO();
                        chat.updatedAt = nowISO();
                        saveState();
                        renderMessages();
                        scrollToBottom();
                    }
                }
            } catch (error) {
                console.error('Error sending message:', error);
            } finally {
                setLoading(false);
            }
        }

        function setLoading(loading) {
            isLoading = loading;
            elements.sendBtn.disabled = loading;
            elements.composerInput.disabled = loading;
            elements.typingStatus.classList.toggle('hidden', !loading);

            if (loading) {
                elements.sendBtn.innerHTML = `
                    <svg class="w-5 h-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                    </svg>
                `;
            } else {
                elements.sendBtn.innerHTML = `
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                    </svg>
                `;
            }
        }

        // Enhanced sidebar functions with mobile optimizations
        function openSidebar() {
            if (window.innerWidth <= 1023) {
                elements.sidebar.classList.remove('hidden');
                elements.sidebar.classList.add('open');
                elements.sidebarOverlay.classList.add('active');
                document.body.style.overflow = 'hidden';

                // Focus trap for accessibility
                const firstFocusable = elements.sidebar.querySelector('button, input');
                if (firstFocusable) {
                    setTimeout(() => firstFocusable.focus(), 100);
                }
            }
        }

        function closeSidebar() {
            if (window.innerWidth <= 1023) {
                elements.sidebar.classList.remove('open');
                elements.sidebarOverlay.classList.remove('active');
                document.body.style.overflow = 'auto';

                setTimeout(() => {
                    if (!elements.sidebar.classList.contains('open')) {
                        elements.sidebar.classList.add('hidden');
                    }
                }, 300);

                // Return focus to main content
                elements.composerInput?.focus();
            }
        }

        // Enhanced auto-resize with mobile optimizations
        function autoResizeTextarea() {
            elements.composerInput.style.height = 'auto';
            const maxHeight = window.innerWidth <= 767 ? 80 : 120;
            const newHeight = Math.min(elements.composerInput.scrollHeight, maxHeight);
            elements.composerInput.style.height = newHeight + 'px';
        }

        // Enhanced render functions
        function renderChatsList(filter = '') {
            const filteredChats = chats.filter(chat =>
                chat.title.toLowerCase().includes(filter.toLowerCase())
            );

            if (filteredChats.length === 0) {
                elements.chatsList.innerHTML = `
                    <div class="text-center py-6 lg:py-8 text-gray-400 px-4">
                        <svg class="w-10 h-10 lg:w-12 lg:h-12 mx-auto mb-3 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                        </svg>
                        <p class="text-sm">No conversations yet</p>
                        <p class="text-xs mt-1">Start a new chat to begin</p>
                    </div>
                `;
                return;
            }

            elements.chatsList.innerHTML = filteredChats.map(chat => {
                const lastMessage = chat.messages[chat.messages.length - 1];
                const isActive = selectedChatId === chat.id;

                return `
                    <div class="chat-item p-3 lg:p-4 cursor-pointer ${isActive ? 'active' : ''}" data-chat-id="${chat.id}">
                        <div class="flex items-start gap-2 lg:gap-3">
                            <div class="w-8 h-8 lg:w-10 lg:h-10 rounded-lg bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center text-white font-bold text-xs lg:text-sm shrink-0">
                                ${chat.title.slice(0, 2).toUpperCase()}
                            </div>
                            <div class="flex-1 min-w-0">
                                <h3 class="text-sm lg:text-sm font-medium text-white truncate mb-1">${escapeHtml(chat.title)}</h3>
                                <p class="text-xs text-gray-400 truncate">
                                    ${lastMessage ?
                        (lastMessage.role === 'user' ? 'You: ' : 'Smart Diamond: ') +
                        truncateText(lastMessage.text.replace(/[#*`]/g, ''), window.innerWidth <= 374 ? 25 : 35)
                        : 'No messages yet'}
                                </p>
                                <p class="text-xs text-gray-500 mt-1">${lastMessage ? formatTime(lastMessage.createdAt) : formatTime(chat.createdAt)}</p>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // Add click listeners with enhanced touch handling
            elements.chatsList.querySelectorAll('.chat-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const chatId = item.dataset.chatId;
                    selectChat(chatId);
                });

                // Enhanced touch feedback
                item.addEventListener('touchstart', () => {
                    item.style.transform = 'scale(0.98)';
                });

                item.addEventListener('touchend', () => {
                    item.style.transform = '';
                });
            });
        }

        function formatMessageContent(text) {
            if (!text) return '';

            let formatted = escapeHtml(text);

            // Enhanced markdown parsing for better formatting
            formatted = formatted.replace(/^### (.*$)/gm, '<h3 class="text-base lg:text-lg font-semibold text-white mt-3 lg:mt-4 mb-2 first:mt-0">$1</h3>');
            formatted = formatted.replace(/^## (.*$)/gm, '<h2 class="text-lg lg:text-xl font-bold text-white mt-4 lg:mt-5 mb-2 lg:mb-3 first:mt-0">$1</h2>');
            formatted = formatted.replace(/^# (.*$)/gm, '<h1 class="text-xl lg:text-2xl font-bold text-white mt-5 lg:mt-6 mb-3 lg:mb-4 first:mt-0">$1</h1>');

            // Bold and italic
            formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong class="font-semibold text-white">$1</strong>');
            formatted = formatted.replace(/(?<!\*)\*([^*\n]+)\*(?!\*)/g, '<em class="italic">$1</em>');

            // Code blocks
            formatted = formatted.replace(/```([\s\S]*?)```/g, '<div class="code-container"><pre class="bg-black/30 border border-white/10 rounded-lg p-2 lg:p-3 mt-2 lg:mt-3 mb-2 lg:mb-3 overflow-x-auto"><code>$1</code></pre><button class="copy-button">Copy</button></div>');
            formatted = formatted.replace(/`([^`\n]+)`/g, '<code class="bg-black/20 px-1 lg:px-2 py-1 rounded text-xs lg:text-sm font-mono text-green-300">$1</code>');

            // Lists
            formatted = formatted.replace(/^- (.*$)/gm, '<li class="ml-3 lg:ml-4 mb-1 list-disc">$1</li>');
            formatted = formatted.replace(/^(\d+)\. (.*$)/gm, '<li class="ml-3 lg:ml-4 mb-1 list-decimal">$1. $2</li>');

            // Wrap consecutive list items
            formatted = formatted.replace(/(<li.*?<\/li>\s*)+/g, '<ul class="my-2 lg:my-3 space-y-1 pl-4">$&</ul>');

            return formatted;
        }

        function renderMessages() {
            const chat = getSelectedChat();

            if (!chat || chat.messages.length === 0) {
                elements.emptyState.style.display = 'flex';
                elements.messages.style.display = 'none';
                return;
            }

            elements.emptyState.style.display = 'none';
            elements.messages.style.display = 'block';

            elements.messages.innerHTML = chat.messages.map((message, index) => {
                const isUser = message.role === 'user';
                const isTyping = message.text === '...';

                if (isTyping) {
                    return `
                        <div class="message-container flex justify-start fade-in" style="animation-delay: ${index * 0.1}s">
                            <div class="typing-indicator">
                                <div class="typing-dot"></div>
                                <div class="typing-dot"></div>
                                <div class="typing-dot"></div>
                                <span class="text-xs lg:text-sm text-gray-400 ml-2">Smart Diamond is thinking...</span>
                            </div>
                        </div>
                    `;
                }

                return `
                    <div class="message-container flex ${isUser ? 'justify-end' : 'justify-start'} fade-in px-3 lg:px-0" style="animation-delay: ${index * 0.1}s">
                        <div class="message-bubble max-w-[90%] sm:max-w-[85%] lg:max-w-[75%]">
                            ${!isUser ? `
                                <div class="flex items-center gap-2 mb-2">
                                    <div class="w-5 h-5 lg:w-6 lg:h-6 rounded-full bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center shrink-0">
                                        <svg class="w-2 h-2 lg:w-3 lg:h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                                        </svg>
                                    </div>
                                    <span class="text-xs lg:text-sm font-medium text-gray-300">Smart Diamond</span>
                                </div>
                            ` : ''}
                            
                            <div class="${isUser ? 'message-user' : 'message-assistant'} rounded-xl lg:rounded-2xl px-3 lg:px-4 py-2 lg:py-3">
                                <div class="text-sm lg:text-base leading-relaxed ${isUser ? 'text-white' : 'text-gray-100'} message-content">
                                    ${formatMessageContent(message.text)}
                                </div>
                                <div class="text-xs ${isUser ? 'text-purple-200' : 'text-gray-400'} mt-2 opacity-75">
                                    ${formatTime(message.createdAt)}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            scrollToBottom();
        }

        function updateHeader() {
            const chat = getSelectedChat();

            if (!chat) {
                elements.chatTitle.textContent = 'New Conversation';
                elements.chatSubtitle.textContent = 'Start chatting with Smart Diamond';
                return;
            }

            elements.chatTitle.textContent = chat.title || 'Untitled Chat';

            // Responsive subtitle
            const messageCount = chat.messages.length;
            const timeText = formatTime(chat.updatedAt);

            if (window.innerWidth <= 374) {
                elements.chatSubtitle.textContent = `${messageCount} msg`;
            } else if (window.innerWidth <= 767) {
                elements.chatSubtitle.textContent = `${messageCount} messages`;
            } else {
                elements.chatSubtitle.textContent = `${messageCount} message${messageCount !== 1 ? 's' : ''} • ${timeText}`;
            }
        }

        function renderAll() {
            renderChatsList(elements.chatSearch.value);
            renderMessages();
            updateHeader();
        }

        // Enhanced event listeners with mobile optimizations
        elements.sidebarToggle?.addEventListener('click', (e) => {
            e.preventDefault();
            openSidebar();
        });

        elements.sidebarClose?.addEventListener('click', (e) => {
            e.preventDefault();
            closeSidebar();
        });

        elements.sidebarOverlay?.addEventListener('click', (e) => {
            e.preventDefault();
            closeSidebar();
        });

        elements.newChatBtn?.addEventListener('click', (e) => {
            e.preventDefault();
            createNewChat();
        });

        elements.chatSearch?.addEventListener('input', (e) => {
            renderChatsList(e.target.value);
        });

        elements.sendBtn?.addEventListener('click', (e) => {
            e.preventDefault();
            if (!isLoading) sendMessage();
        });

        elements.composerInput?.addEventListener('input', autoResizeTextarea);

        elements.composerInput?.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                if (!isLoading) sendMessage();
            }
        });

        elements.renameBtn?.addEventListener('click', (e) => {
            e.preventDefault();
            const chat = getSelectedChat();
            if (chat) renameChat(chat.id);
        });

        elements.deleteBtn?.addEventListener('click', (e) => {
            e.preventDefault();
            const chat = getSelectedChat();
            if (chat) deleteChat(chat.id);
        });

        elements.exportBtn?.addEventListener('click', (e) => {
            e.preventDefault();
            const chat = getSelectedChat();
            if (chat) exportChat(chat.id);
        });

        elements.quickExampleBtn?.addEventListener('click', async (e) => {
            e.preventDefault();
            if (!selectedChatId) createNewChat('UX Design Tips');
            elements.composerInput.value = "Give me 5 modern web design principles that will make my website stand out in 2025";
            autoResizeTextarea();
            await sendMessage();
        });

        // Enhanced keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeSidebar();
            }

            if ((e.metaKey || e.ctrlKey) && e.key === 'n') {
                e.preventDefault();
                createNewChat();
            }
        });

        // Enhanced window resize handler
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                if (window.innerWidth > 1023) {
                    elements.sidebar.classList.remove('hidden', 'open');
                    elements.sidebarOverlay.classList.remove('active');
                    document.body.style.overflow = 'auto';
                }

                // Re-render to adjust responsive elements
                updateHeader();
                autoResizeTextarea();
            }, 100);
        });

        // Enhanced orientation change handler
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                updateHeader();
                scrollToBottom();
                autoResizeTextarea();
            }, 300);
        });

        // Touch gesture enhancements
        let touchStartX = 0;
        let touchStartY = 0;

        document.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        });

        document.addEventListener('touchmove', (e) => {
            if (!elements.sidebar.classList.contains('open')) return;

            const touchX = e.touches[0].clientX;
            const touchY = e.touches[0].clientY;
            const deltaX = touchX - touchStartX;
            const deltaY = Math.abs(touchY - touchStartY);

            // Swipe left to close sidebar (only if vertical movement is minimal)
            if (deltaX < -50 && deltaY < 100 && window.innerWidth <= 1023) {
                closeSidebar();
            }
        });

        // Initialize app with mobile optimizations
        function initializeApp() {
            loadState();

            // Create welcome chat if no chats exist
            if (chats.length === 0) {
                createNewChat('Welcome to Smart Diamond');
                addMessage('assistant', `# 👋 Welcome to Smart Diamond!

I'm your intelligent AI assistant, designed to provide **elegant, structured responses** with beautiful formatting.

## ✨ What I can help with:
- **Answer questions** with detailed explanations
- **Provide insights** on various topics  
- **Format responses** with headings, lists, and code
- **Maintain context** throughout our conversation

## 🚀 Getting Started:
Simply type your question below and press Enter. I'll respond with well-organized, visually appealing answers that are easy to read and understand.\n
*Ready to explore? Ask me anything!*`);
                saveState();
            }

            // Set initial selected chat
            if (!selectedChatId && chats.length > 0) {
                selectedChatId = chats[0].id;
            }

            renderAll();

            // Enhanced focus management
            setTimeout(() => {
                if (window.innerWidth > 767) {
                    elements.composerInput?.focus();
                }
            }, 500);

            // Prevent zoom on iOS
            if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
                document.addEventListener('touchstart', () => { }, { passive: true });
            }
        }

        // Start the application
        initializeApp();
    </script>
</body>

</html>